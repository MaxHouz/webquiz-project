function generateId(e){var t=[];for(key in e){var n=key.match(/[0-9]{1,}/)[0];t.push(n)}return t.length?arrayMax(t)+1:1}function arrayMax(e){return Math.max.apply(null,e)}function userControl(){var e=document.querySelector(".quiz_start"),t=document.querySelector(".login_anchor");queryArray=window.location.search.split("&"),(currentUser=queryArray[0].split("=")[1])||(e.style.display="none",t.style.display="block",t.addEventListener("click",showLogInForm))}function formLink(e,t){var n,i;return-1==e.indexOf("#")?(i=e.split("?"),n=i[0]+"?userid="+t+(i[1]?"&"+i[1]:"")):-1==e.indexOf("userid")?(i=e.split("#"),n=i[0]+"?userid="+t+"#"+i[1]):(i=e.split("#"),n="#"+i[1]),n}function showLogInForm(){loginForm.classList.add("active"),loginItem.classList.add("active")}function Question(e,t,n){this.text=e,this.choices=t,this.answer=n}function getQuizData(e,t){var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e,!1),n.onreadystatechange=function(){4===n.readyState&&"200"==n.status&&t(n.responseText)},n.send(null)}function formQuestionList(e){var t;getQuizData(e,function(e){t=JSON.parse(e)});var n=t,i=[];return n.map(function(e){i.push(new Question(e.questionText,e.choises,e.answer))}),i}function Quiz(e,t,n){this._type=n,this._score=0,this._questionIndex=0,this.questions=e,this._answers=[],this.container=document.querySelector(t)}function answerChange(){var e=document.querySelector(".quiz_btn.active");e&&e.classList.remove("active"),this.classList.toggle("active"),document.getElementById("confirm").disabled=!1}function Timer(e){function t(){o+=n(),e.innerHTML=i(o)}function n(){var e=Date.now(),t=e-s;return s=e,t}function i(e){var t=new Date(e),n=t.getMinutes().toString(),i=t.getSeconds().toString();return n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),n+": "+i}var r,s,o=1;this._works=!1,this.start=function(){this._works||(r=setInterval(t,10),s=Date.now(),this._works=!0)},this.stop=function(){this._works&&(clearInterval(r),r=null,this._works=!1)},this.reset=function(){o=0},this.timeStop=function(){return this.stop(),e.innerHTML}}function saveResults(e,t,n,i,r){var s=new Date,o=s.getDate();o=1==o.toString().length?"0"+o:o;var u=s.getMonth()+1,c=1==u.toString().length?"0"+u:u,a=s.getFullYear(),l=JSON.parse(localStorage.getItem("users")),h="quizId"+generateId(quizesObject),d="quizId1"===h?{}:quizesObject;l[currentUser].quizes.push(h),d[h]={type:i,score:e,total:t,userAnswers:r,time:n,date:o+"."+c+"."+a},localStorage.setItem("quizes",JSON.stringify(d)),localStorage.setItem("users",JSON.stringify(l)),showResults(h,currentUser)}function showResults(e,t){window.location="report.html?userid="+t+"&quizid="+e}function initData(){if(quiz.finished())saveResults(quiz._score,quiz.questions.length,time.timeStop(),quiz._type,quiz._answers);else{quiz.renderCurrentQuestion();document.querySelector(".total-questions").innerHTML=quiz.questions.length;document.querySelector(".question_text").innerHTML=quiz.getCurrentQuestion().text;quiz.getCurrentQuestion().choices.map(function(e){document.getElementById("choice"+e.id).innerHTML=e.variant}),choiceConfirm(),showProgress()}}function choiceConfirm(){var e=document.getElementById("confirm");e.onclick=function(){var t=document.querySelector(".quiz_btn.active");quiz._answers.push(t.innerHTML),quiz.check(t.innerHTML),initData(),e.disabled=!0}}function showProgress(){var e=quiz._questionIndex+1;document.querySelector(".current-question").innerHTML=e}var currentUser;document.addEventListener("DOMContentLoaded",userControl);var searchBtn=document.getElementById("search"),searchInput=document.getElementById("search_input");searchBtn.addEventListener("change",function(){searchInput.classList.toggle("active")});var userElems=document.querySelectorAll(".user"),fastLinks=document.querySelectorAll(".quizes_dropdown-link"),menuItems=document.querySelectorAll(".header_menu-link"),homeLogo=document.querySelector(".header_logo-link");if(queryArray=window.location.search.split("&"),currentUser=queryArray[0].split("=")[1]){homeLogo.href=formLink(homeLogo.href,currentUser);for(var j=0;j<menuItems.length;j++)menuItems[j].href=formLink(menuItems[j].href,currentUser);for(var i=0;i<fastLinks.length;i++)fastLinks[i].href=formLink(fastLinks[i].href,currentUser)}else for(var i=0;i<userElems.length;i++)userElems[i].addEventListener("click",function(e){e.preventDefault(),showLogInForm()});Question.prototype.correctAnswer=function(e){return e===this.answer},Quiz.prototype.getCurrentQuestion=function(){return this.questions[this._questionIndex]},Quiz.prototype.finished=function(){return this.questions.length===this._questionIndex},Quiz.prototype.check=function(e){this.getCurrentQuestion().correctAnswer(e)&&this._score++,this._questionIndex++},Quiz.prototype.renderCurrentQuestion=function(){var e="",t=0;this.questions[this._questionIndex].choices.map(function(n){e+='<li class="quiz_btn" id="choice'+t+'"></li>',t++}),this.container.innerHTML=e;var n=document.getElementById("choice0"),i=document.getElementById("choice1"),r=document.getElementById("choice2"),s=document.getElementById("choice3");n&&n.addEventListener("click",answerChange),i&&i.addEventListener("click",answerChange),r&&r.addEventListener("click",answerChange),s&&s.addEventListener("click",answerChange)};var quizesObject=JSON.parse(localStorage.getItem("quizes")),currentQuiz,timer=document.getElementById("timer"),time=new Timer(timer),titleContainer=document.querySelector(".quiz_title-text"),picContainer=document.querySelector(".quiz_title-pic"),getQueryString,type,quizDetect=window.location.search.split("&")[1];switch(quizDetect){case"type=js":getQueryString="json/jsQuestions.json",type="js",titleContainer.innerHTML="JavaScript",picContainer.src="img/quiz-logos/js.png";break;case"type=html":getQueryString="json/htmlQuestions.json",type="html",titleContainer.innerHTML="HTML",picContainer.src="img/quiz-logos/html.png";break;case"type=css":getQueryString="json/cssQuestions.json",type="css",titleContainer.innerHTML="CSS",picContainer.src="img/quiz-logos/css.png"}var questions=formQuestionList(getQueryString),quiz=new Quiz(questions,".btns_list",type);initData(),time.start();