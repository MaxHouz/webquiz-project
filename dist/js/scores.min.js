function generateId(e){var r=[];for(key in e){var t=key.match(/[0-9]{1,}/)[0];r.push(t)}return r.length?arrayMax(r)+1:1}function arrayMax(e){return Math.max.apply(null,e)}function addUser(e){var r="user"+generateId(usersObject),t="user1"===r?{}:usersObject;t[r]={login:e,quizes:[]},localStorage.setItem("users",JSON.stringify(t))}function logIn(){function e(){"new-user-yes"===this.id?(addUser(n),r()):"new-user-no"===this.id&&newUserForm.classList.remove("active")}function r(){usersObject=JSON.parse(localStorage.getItem("users")),t=getIdbbyName(n),window.location="?userid="+t}var t,n=loginInput.value;if(userCheck(n))r();else{newUserForm.classList.add("active");for(var o=0;o<newUserConf.length;o++)newUserConf[o].addEventListener("click",e)}}function userCheck(e){for(key in usersObject)if(usersObject[key].login==e)return!0;return!1}function getIdbbyName(e){var r;for(key in usersObject)usersObject[key].login==e&&(r=key);return r}function userControl(){var e=document.querySelector(".quiz_start"),r=document.querySelector(".login_anchor");queryArray=window.location.search.split("&"),(currentUser=queryArray[0].split("=")[1])||(e.style.display="none",r.style.display="block",r.addEventListener("click",showLogInForm))}function formLink(e,r){var t,n;return-1==e.indexOf("#")?(n=e.split("?"),t=n[0]+"?userid="+r+(n[1]?"&"+n[1]:"")):-1==e.indexOf("userid")?(n=e.split("#"),t=n[0]+"?userid="+r+"#"+n[1]):(n=e.split("#"),t="#"+n[1]),t}function showLogInForm(){loginForm.classList.add("active"),loginItem.classList.add("active")}function logout(){if(currentUser){var e=document.querySelector(".header_menu-link.log");e.innerHTML="Log out",e.addEventListener("click",function(e){e.preventDefault();var r=window.location.pathname;window.location=r.split("?")[0]})}}function blockLogInForm(){void 0===currentUser&&loginBtn.addEventListener("click",function(e){e.preventDefault(e),loginForm.classList.toggle("active"),loginItem.classList.toggle("active")})}function createScoresMarkup(e){for(var r='<div class="quiz_count"></div>',t='<div class="quiz_type"></div>',n='<div class="quiz_score">Score: </div>',o='<div class="quiz_date">Date: </div>',i='<li class="quiz_item">'+r+t+n+o+"</li>";e>0;)scoresContainer.innerHTML+=i,e--}function initScoresData(e){for(var r=document.querySelectorAll(".quiz_count"),t=document.querySelectorAll(".quiz_type"),n=document.querySelectorAll(".quiz_score"),o=document.querySelectorAll(".quiz_date"),i=document.querySelectorAll(".quiz_item"),s=0;s<e.length;s++)r[s].innerHTML=s+1,t[s].innerHTML=quizesObject[e[s]].type,n[s].innerHTML+=quizesObject[e[s]].score,o[s].innerHTML+=quizesObject[e[s]].date,i[s].addEventListener("click",goToQuizReport)}function goToQuizReport(){var e=this.querySelector(".quiz_count").innerHTML;window.location="report.html?userid="+currentUser+"&quizid=quizId"+e}var usersObject=JSON.parse(localStorage.getItem("users")),loginInput=document.querySelector(".login_input"),loginConfirm=document.querySelector(".login_confirm"),newUserForm=document.querySelector(".new_user"),newUserConf=document.querySelectorAll(".new_user-conf"),newUserYes=document.getElementById("new-user-yes"),newUserNo=document.getElementById("new-user-no");loginInput.addEventListener("keyup",function(e){13===e.keyCode&&loginConfirm.click()}),loginConfirm.addEventListener("click",logIn);var currentUser;document.addEventListener("DOMContentLoaded",userControl),document.addEventListener("DOMContentLoaded",logout);var searchBtn=document.getElementById("search"),searchInput=document.getElementById("search_input");searchBtn.addEventListener("change",function(){searchInput.classList.toggle("active")});var userElems=document.querySelectorAll(".user"),fastLinks=document.querySelectorAll(".quizes_dropdown-link"),menuItems=document.querySelectorAll(".header_menu-link"),homeLogo=document.querySelector(".header_logo-link");if(queryArray=window.location.search.split("&"),currentUser=queryArray[0].split("=")[1]){homeLogo.href=formLink(homeLogo.href,currentUser);for(var j=0;j<menuItems.length;j++)menuItems[j].href=formLink(menuItems[j].href,currentUser);for(var i=0;i<fastLinks.length;i++)fastLinks[i].href=formLink(fastLinks[i].href,currentUser)}else for(var i=0;i<userElems.length;i++)userElems[i].addEventListener("click",function(e){e.preventDefault(),showLogInForm()});document.addEventListener("DOMContentLoaded",blockLogInForm);var loginBtn=document.querySelector(".header_menu-link.log"),loginForm=document.querySelector(".login_form"),loginItem=document.querySelector(".header_menu-item.log"),scoresTitle=document.querySelector(".scores_section-title"),scoresContainer=document.querySelector(".scores_quizes-list"),usersObject=JSON.parse(localStorage.getItem("users")),currentUserObject=usersObject[currentUser],userQuizes=currentUserObject.quizes,quizesObject=JSON.parse(localStorage.getItem("quizes"));scoresTitle.innerHTML=currentUserObject.login+"'s quiz results",createScoresMarkup(userQuizes.length),initScoresData(userQuizes);